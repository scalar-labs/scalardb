name: CI

on: [ push ]

env:
  TERM: dumb
jobs:
  check-1:
    runs-on: self-hosted
    steps:
      - uses: actions/checkout@v3

      - name: Set up JDK 8
        uses: actions/setup-java@v3
        with:
          java-version: '8'
          distribution: 'temurin'


      - name: Setup and execute Gradle 'check' task
        uses: gradle/gradle-build-action@v2
        with:
          arguments: check

      - name: Save Gradle test reports
        if: always()
        run: |
          mkdir -p /tmp/gradle_test_reports/core
          mkdir -p /tmp/gradle_test_reports/server
          mkdir -p /tmp/gradle_test_reports/schema-loader
          cp -a core/build/reports/tests/test /tmp/gradle_test_reports/core/
          cp -a server/build/reports/tests/test /tmp/gradle_test_reports/server/
          cp -a schema-loader/build/reports/tests/test /tmp/gradle_test_reports/schema-loader/

      - name: Save SpotBugs reports
        if: always()
        run: |
          mkdir -p /tmp/gradle_spotbugs_reports/core
          mkdir -p /tmp/gradle_spotbugs_reports/server
          mkdir -p /tmp/gradle_spotbugs_reports/schema-loader
          cp -a core/build/reports/spotbugs /tmp/gradle_spotbugs_reports/core/
          cp -a server/build/reports/spotbugs /tmp/gradle_spotbugs_reports/server/
          cp -a schema-loader/build/reports/spotbugs /tmp/gradle_spotbugs_reports/schema-loader/

      - name: Upload Gradle test reports
        if: always()
        uses: actions/upload-artifact@v3
        with:
          name: gradle_test_reports
          path: /tmp/gradle_test_reports

      - name: Upload Spotbugs reports
        if: always()
        uses: actions/upload-artifact@v3
        with:
          name: gradle_spotbugs_reports
          path: /tmp/gradle_spotbugs_reports
  check-2:
    runs-on: self-hosted
    steps:
      - uses: actions/checkout@v3

      - name: Set up JDK 8
        uses: actions/setup-java@v3
        with:
          java-version: '8'
          distribution: 'temurin'


      - name: Setup and execute Gradle 'check' task
        uses: gradle/gradle-build-action@v2
        with:
          arguments: check

      - name: Save Gradle test reports
        if: always()
        run: |
          mkdir -p /tmp/gradle_test_reports/core
          mkdir -p /tmp/gradle_test_reports/server
          mkdir -p /tmp/gradle_test_reports/schema-loader
          cp -a core/build/reports/tests/test /tmp/gradle_test_reports/core/
          cp -a server/build/reports/tests/test /tmp/gradle_test_reports/server/
          cp -a schema-loader/build/reports/tests/test /tmp/gradle_test_reports/schema-loader/

      - name: Save SpotBugs reports
        if: always()
        run: |
          mkdir -p /tmp/gradle_spotbugs_reports/core
          mkdir -p /tmp/gradle_spotbugs_reports/server
          mkdir -p /tmp/gradle_spotbugs_reports/schema-loader
          cp -a core/build/reports/spotbugs /tmp/gradle_spotbugs_reports/core/
          cp -a server/build/reports/spotbugs /tmp/gradle_spotbugs_reports/server/
          cp -a schema-loader/build/reports/spotbugs /tmp/gradle_spotbugs_reports/schema-loader/

      - name: Upload Gradle test reports
        if: always()
        uses: actions/upload-artifact@v3
        with:
          name: gradle_test_reports
          path: /tmp/gradle_test_reports

      - name: Upload Spotbugs reports
        if: always()
        uses: actions/upload-artifact@v3
        with:
          name: gradle_spotbugs_reports
          path: /tmp/gradle_spotbugs_reports
  check-3:
    runs-on: self-hosted
    steps:
      - uses: actions/checkout@v3

      - name: Set up JDK 8
        uses: actions/setup-java@v3
        with:
          java-version: '8'
          distribution: 'temurin'


      - name: Setup and execute Gradle 'check' task
        uses: gradle/gradle-build-action@v2
        with:
          arguments: check

      - name: Save Gradle test reports
        if: always()
        run: |
          mkdir -p /tmp/gradle_test_reports/core
          mkdir -p /tmp/gradle_test_reports/server
          mkdir -p /tmp/gradle_test_reports/schema-loader
          cp -a core/build/reports/tests/test /tmp/gradle_test_reports/core/
          cp -a server/build/reports/tests/test /tmp/gradle_test_reports/server/
          cp -a schema-loader/build/reports/tests/test /tmp/gradle_test_reports/schema-loader/

      - name: Save SpotBugs reports
        if: always()
        run: |
          mkdir -p /tmp/gradle_spotbugs_reports/core
          mkdir -p /tmp/gradle_spotbugs_reports/server
          mkdir -p /tmp/gradle_spotbugs_reports/schema-loader
          cp -a core/build/reports/spotbugs /tmp/gradle_spotbugs_reports/core/
          cp -a server/build/reports/spotbugs /tmp/gradle_spotbugs_reports/server/
          cp -a schema-loader/build/reports/spotbugs /tmp/gradle_spotbugs_reports/schema-loader/

      - name: Upload Gradle test reports
        if: always()
        uses: actions/upload-artifact@v3
        with:
          name: gradle_test_reports
          path: /tmp/gradle_test_reports

      - name: Upload Spotbugs reports
        if: always()
        uses: actions/upload-artifact@v3
        with:
          name: gradle_spotbugs_reports
          path: /tmp/gradle_spotbugs_reports